@model proekt.Models.ViewModels.DoctorDashboardViewModel
@{
    ViewData["Title"] = "Doctor Dashboard";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<div class="dd-page">
    <!-- Header -->
    <div class="dd-header">
        <div>
            <h2 class="mb-1"><i class="bi bi-clipboard2-pulse me-2"></i>Doctor Dashboard</h2>
            <p class="text-white-50 mb-0">Search and manage patient medical records</p>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="dd-search-wrap">
        <form method="get" asp-controller="MedicalRecord" asp-action="DoctorDashboard" class="dd-search-form">
            <div class="dd-search-box">
                <i class="bi bi-search dd-search-icon"></i>
                <input type="text" name="q" value="@Model.SearchQuery"
                       class="dd-search-input" placeholder="Search by name, email or IDâ€¦" autocomplete="off" />
                <button type="submit" class="btn btn-primary dd-search-btn">Search</button>
                @if (!string.IsNullOrWhiteSpace(Model.SearchQuery))
                {
                    <a href="@Url.Action("DoctorDashboard","MedicalRecord")" class="btn btn-outline-secondary dd-search-btn">Clear</a>
                }
            </div>
        </form>
    </div>

    <!-- Stats row -->
    <div class="dd-stats">
        <div class="dd-stat-card">
            <div class="dd-stat-icon" style="background:#dbeafe;color:#2563eb;"><i class="bi bi-people-fill"></i></div>
            <div>
                <div class="dd-stat-label">Total Patients</div>
                <div class="dd-stat-value">@Model.Patients.Count</div>
            </div>
        </div>
        @if (!string.IsNullOrWhiteSpace(Model.SearchQuery))
        {
            <div class="dd-stat-card">
                <div class="dd-stat-icon" style="background:#d1fae5;color:#059669;"><i class="bi bi-funnel-fill"></i></div>
                <div>
                    <div class="dd-stat-label">Search Results</div>
                    <div class="dd-stat-value">@Model.Patients.Count results for "@Model.SearchQuery"</div>
                </div>
            </div>
        }
    </div>

    <!-- Patient List -->
    @if (!Model.Patients.Any())
    {
        <div class="dd-empty">
            <i class="bi bi-person-x"></i>
            <p>No patients found.</p>
        </div>
    }
    else
    {
        <div class="dd-patient-grid">
            @foreach (var patient in Model.Patients)
            {
                <div class="dd-patient-card">
                    <div class="dd-patient-avatar">@(patient.FullName?.Substring(0,1).ToUpper() ?? "?")</div>
                    <div class="dd-patient-info">
                        <div class="dd-patient-name">@patient.FullName</div>
                        <div class="dd-patient-email"><i class="bi bi-envelope"></i> @patient.Email</div>
                        @if (!string.IsNullOrWhiteSpace(patient.PhoneNumber))
                        {
                            <div class="dd-patient-phone"><i class="bi bi-telephone"></i> @patient.PhoneNumber</div>
                        }
                        <div class="dd-patient-role-row">
                            <span class="dd-role-badge dd-role-@patient.Role.ToString().ToLower()">@patient.Role</span>
                            <span class="dd-patient-since"><i class="bi bi-calendar3"></i> Since @patient.CreatedAt.ToString("MMM yyyy")</span>
                        </div>
                    </div>
                    <a href="@Url.Action("ViewRecord","MedicalRecord", new { userId = patient.Id })"
                       class="btn btn-primary btn-sm dd-view-btn">
                        <i class="bi bi-folder2-open"></i> View Record
                    </a>
                </div>
            }
        </div>
    }
</div>
